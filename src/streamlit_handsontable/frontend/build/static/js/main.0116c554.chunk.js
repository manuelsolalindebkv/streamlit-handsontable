(this.webpackJsonpstreamlit_handsontable=this.webpackJsonpstreamlit_handsontable||[]).push([[0],{134:function(e,o,t){e.exports=t(185)},185:function(e,o,t){"use strict";t.r(o);var n=t(9),l=t.n(n),a=t(53),r=t.n(a),s=t(59),c=t(72),i=(t(183),t(107));Object(i.a)();var u=e=>{let{data:o,df_key:t,table_version:a,columns_config:r,reaction:s,height:i,afterChange:u,afterRowAdd:d,afterRowDelete:f,afterReaction:g,onReload:h,hide_columns:m}=e;const{columns:_,data:p}=o,{reaction_id:w}=s;let b=[];_.forEach((e,o)=>{let t={};r.hasOwnProperty(e)&&(t=r[e]),t.data=o,b.push(t)}),console.log("hotcolumn_settings",b);const[y,R]=l.a.useState(p),O=_.filter(e=>e.startsWith("_")),C=_.indexOf("_id"),v=_.indexOf("_version"),E=Object(n.useRef)(null);Object(n.useEffect)(()=>{console.log("reaction triggered");const e=E.current.hotInstance,{reaction_type:o}=s;if("update_rows"===o){if(s.hasOwnProperty("alert_message")){const e=s.alert_message;alert(e)}const o=s.rows;for(let t of o){let o=t._row_index,n=_.map(e=>t[e]);console.log("updating row",o,n),n.map((t,n)=>{e.setSourceDataAtCell(o,n,t)})}}else if("undo"===o)alert("Error: undoing"),e.undo();else if("error"===o){const e=s.error_message;alert("Error: "+e)}g()},[w]),Object(n.useEffect)(()=>{E.current;console.log("initial_tabledata changed")},[p]),Object(n.useEffect)(()=>{R(p)},[a]);let x=m.map(e=>_.indexOf(e)).filter(e=>-1!==e);return console.log(s),l.a.createElement(c.b,{data:y,height:i,dropdownMenu:["filter_by_condition","filter_action_bar","filter_by_value"],hiddenColumns:{columns:x,indicators:!1},columnSorting:!0,filters:!0,contextMenu:!0,colHeaders:_,rowHeaders:!0,sortByRelevance:!0,autoWrapCol:!0,autoWrapRow:!0,licenseKey:"non-commercial-and-evaluation",afterChange:(e,o)=>{const t=E.current;if(w)console.log("skiping afterchange");else if(console.log("afterchange triggered","source: ",o),t){let o=t.hotInstance;if(e&&e.length>0){e=(e=e.filter(e=>{const[o,t,n,l]=e,a=_[t];return!O.includes(a)})).filter(e=>{const[o,t,n,l]=e,a=[null,void 0,""];return!(a.includes(n)&&a.includes(l))}),console.log("changes",e);let t=e.map(e=>{const[t,n,l,a]=e;return[o.toPhysicalRow(t),o.toPhysicalColumn(n),l,a]});console.log("physical_changes",t);let n=[];for(let e of t){let[t,l,a,s]=e,c=_[l];if(r.hasOwnProperty(c)){let e=r[c];if(e.hasOwnProperty("type")){let o=e.type;"numeric"===o?s=parseFloat(s):"checkbox"===o&&(s=!0===s)}}let i=O.reduce((t,n)=>{let l=_.indexOf(n),a=o.getSourceDataAtCell(e[0],l);return t[n]=a,t},{}),u=_[l];n.push({row_index:t,column:u,old_value:a,new_value:s,...i});let d=o.getSourceDataAtCell(t,v);o.suspendRender(),o.suspendExecution(),o.setSourceDataAtCell(t,v,d+1),o.resumeRender(),o.resumeExecution()}console.log("list_of_changes",n),n.length>0?u(n):console.log("no changes")}}else console.error("hotTableClass is null"),u([])},afterCreateRow:(e,o)=>{console.log("row added ",e);const t=E.current;if(w)console.log("skiping afterRowAdd");else if(e&&t){let o=t.hotInstance.toPhysicalRow(e);console.log("physicalRowIndex",o),d(o)}else 0===e?d(e):console.error("hotTableClass is null")},beforeCreateRow:(e,o,t)=>{console.log("beforeCreateRow",e,o,t);const n=E.current;if(!n)return console.error("hotTableClass is null"),!1;{let e=n.hotInstance;const o=e.getPlugin("Filters");console.log("filtersPlugin",o),console.log("hotTableClass",n),console.log("hotInstance",e)}},beforeRemoveRow:(e,o,t,n)=>{console.log(e,o,t,n);const l=E.current.hotInstance;let a=t.map(e=>l.getSourceDataAtCell(e,C));console.log("row_ids",a),f(a)},colWidths:_.map(e=>Math.min(999,100)),stretchH:"all",ref:E,undo:!0,dateFormat:"YYYY-MM-DD",columns:_.map(e=>({readOnly:O.includes(e)})),manualColumnResize:!0},b.map((e,o)=>l.a.createElement(c.a,Object.assign({key:o},e,{readOnly:O.includes(_[o])}))))},d=1;var f=Object(s.b)(e=>{let{args:o}=e;const t=o.override_height,a=o.df_json,r=JSON.parse(a),c=o.table_version,i=o.hide_columns,f=JSON.parse(o.reaction),g=o.df_key,h=JSON.parse(o.columns_config),{reaction_id:m}=f,[_,p]=l.a.useState(f);console.log(r),console.log(h);const{columns:w}=r,b=w.filter((e,o)=>{if(h.hasOwnProperty(e)&&h[e].hasOwnProperty("type")&&"date"===h[e].type)return!0});b.map(e=>w.indexOf(e));console.log("columns_with_dates",b),Object(n.useEffect)(()=>{s.a.setFrameHeight(t)},[t]);const y=(e,o)=>{var t={};let n;"afterChange"===o&&(t[o]=e),"afterRowAdd"===o&&(t[o]=e),"afterRowDelete"===o&&(t[o]=e),"afterUndo"===o&&(t[o]=!0),d+=1,t.version=d,console.log("version_count",d),console.log("response",t),n=JSON.stringify(t);s.a.setComponentValue(n)};Object(n.useEffect)(()=>{p(f)},[m]);return l.a.createElement("div",null,l.a.createElement(u,{data:r,df_key:g,columns_config:h,table_version:c,reaction:_,height:t,afterChange:e=>y(e,"afterChange"),afterRowAdd:e=>y(e,"afterRowAdd"),afterRowDelete:e=>y(e,"afterRowDelete"),afterReaction:()=>{console.log("afterReaction"),p({reaction_id:void 0})},onReload:()=>console.log("reloaded"),hide_columns:i}))});r.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(f,null)),document.getElementById("root"))}},[[134,1,2]]]);
//# sourceMappingURL=main.0116c554.chunk.js.map